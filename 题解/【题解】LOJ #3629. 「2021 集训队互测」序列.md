# 【题解】LOJ #3629. 「2021 集训队互测」序列

## 题目链接

[LOJ #3629. 「2021 集训队互测」序列](https://loj.ac/p/3629)

## 题意概述

有一个长度为 $n$ 的序列 $a_1,a_2,\dots,a_n$，序列里的每个元素都是 $[1,10^9]$ 内的正整数。

现在已知了 $m$ 条信息，每条信息形如 $i,j,k,x$，表示这个序列满足 $a_i+a_j+a_k−\max(a_i,a_j,a_k)−\min(a_i,a_j,a_k)=x$。

请构造一个满足条件的序列。

## 思路分析

给定一些满足三元关系的条件，然后要构造一个满足条件的序列。

容易看出，要用 2-SAT。

但是我们学过的 2-SAT 是给定一些满足**二元逻辑关系**的条件，而非三元关系。

所以考虑三元如何转化为二元。

发现题目中每一个条件，相当于是给定 $a_i,a_j,a_k$ 中的中位数 $x$，其实可以转化为：

$\max(a_i,a_j)\ge x,\min(a_i,a_j)\le x$ 这样类似的六个三类二元条件。

可以发现，这六个条件和题目中的条件是互为**充要条件**的。

那么我们可以将问题转化为：

> 需要构造一个长度为 $n$ 的序列，有 $m$ 个条件，每个条件给定 $i,j,k,x$，满足：$\max(a_i,a_j)\ge x,\min(a_i,a_j)\le x,\max(a_i,a_k)\ge x,\min(a_i,a_k)\le x,\max(a_j,a_k)\ge x,\min(a_j,a_k)\le x$。

考虑对于一个条件 $\max(a_i,a_j)\ge x$ 怎么用 2-SAT 处理。

由于 2-SAT 处理的条件是“若 $(\lnot )a_i$，则有 $(\lnot)a_j$”的形式，所以我们可以先将题目转化成这个形式。

当 $a_i< x$ 时，$a_j \ge x$。

所以我们可以直接定义命题 $P_{i,x}$ 表示的是 $[a_i\ge x]$，则上述条件可以写成若 $\lnot P_{i,x}$，则 $P_{j,x}$。

那么每次可以直接从 $\lnot P_{i,x}$ 到 $P_{j,x}$ 连一条有向边，然后利用 2-SAT 求解。

而对于 $\min(a_i,a_j)\le x$ 的条件，我们同样可以在上述命题的定义下求解：

当 $\min(a_i,a_j)\le x$ 时说明：当 $a_i> x$ 时，$a_j\le x$。由于 $a_i$ 一定是整数，所以其实可以转化为：

当 $a_i\ge x+1$ 时，$a_j <x+1$。

直接从 $\lnot P_{i,x+1}$ 连一条到 $P_{j,x+1}$ 的边即可。

换句话说，我们对于 $m$ 个条件的每个条件 $i,j,k,x$，需要连以下边：

- $\lnot P_{i,x}\to P_{j,x}$；
- $\lnot P_{i,x}\to P_{k,x}$；
- $\lnot P_{j,x}\to P_{i,x}$；
- $\lnot P_{j,x}\to P_{k,x}$；
- $\lnot P_{k,x}\to P_{i,x}$；
- $\lnot P_{k,x}\to P_{j,x}$；
- $P_{i,x+1}\to \lnot P_{j,x+1}$；
- $P_{i,x+1}\to \lnot P_{k,x+1}$；
- $P_{j,x+1}\to \lnot P_{i,x+1}$；
- $P_{j,x+1}\to \lnot P_{k,x+1}$；
- $P_{k,x+1}\to \lnot P_{i,x+1}$；
- $P_{k,x+1}\to \lnot P_{j,x+1}$。

除此之外，由于每个元素都是 $[1,10^9]$ 的正整数，所以我们对 $a_i$ 建立两个虚点 $1$ 和 $10^9$，分别表示 $a_i\ge 1$ 且 $a_i\le  10^9$。对于每一个 $a_i$ 对应的所有 $x$，我们可以先将他们排个序，然后从小到大对相邻的两个 $x_j$ 和 $x_k$，依次连两条边：$P_{i,x_k}\to P_{i,x_j}$ 和 $\lnot P_{i,x_j}\to \lnot P_{i,x_k}$，分别表示当 $a_i\ge x_k$ 则一定 $\ge x_j$，以及 $a_i\le x_j$ 则一定 $\le x_k$。

需要注意的是，我们显然并不需要对于建立 $nm$ 个点来表示每个 $P_{i,x}$，因为每个 $x$ 实际上只会对应三个 $i$。所以实际上，我们建立的点只有 $n+m$ 这个级别的。

连边完了，我们考虑如何构造。

 
